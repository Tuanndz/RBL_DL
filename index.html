<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roblox</title>
    <style>
        /* CSS Variables - Updated with glassmorphism and gradient colors */
        :root {
            --primary-color: #006AFF;
            --primary-dark: #0051cc;
            --primary-light: #4d94ff;
            --secondary-color: #9c27b0;
            --secondary-light: #d05ce3;
            --success-color: #00e676;
            --danger-color: #ff5252;
            --warning-color: #ffd740;
            --light-color: #f8f9fa;
            --dark-color: #121212;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --background-color: #ffffff;
            --card-background: rgba(255, 255, 255, 0.8);
            --border-color: rgba(0, 106, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --gradient-primary: linear-gradient(135deg, #006AFF, #9c27b0);
            --gradient-secondary: linear-gradient(135deg, #4d94ff, #d05ce3);
            --gradient-dark: linear-gradient(135deg, #121212, #1a1a2e);
            --gradient-card: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            --border-radius: 20px;
        }

        [data-theme="dark"] {
            --primary-color: #4d94ff;
            --primary-dark: #006AFF;
            --primary-light: #80b3ff;
            --secondary-color: #d05ce3;
            --secondary-light: #e891f5;
            --success-color: #00e676;
            --danger-color: #ff5252;
            --warning-color: #ffd740;
            --light-color: #1e1e1e;
            --dark-color: #f8f9fa;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --background-color: #121212;
            --card-background: rgba(30, 30, 30, 0.8);
            --border-color: rgba(77, 148, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glass-bg: rgba(30, 30, 30, 0.25);
            --glass-border: rgba(77, 148, 255, 0.18);
            --gradient-primary: linear-gradient(135deg, #4d94ff, #d05ce3);
            --gradient-secondary: linear-gradient(135deg, #80b3ff, #e891f5);
            --gradient-dark: linear-gradient(135deg, #121212, #1a1a2e);
            --gradient-card: linear-gradient(135deg, rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.7));
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            touch-action: manipulation;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.5s ease;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--card-background);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Fade-in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.8s ease forwards;
        }

        /* Screen Management */
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .screen.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.8s ease;
        }

        /* Login Screen - Updated with glassmorphism */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 15s infinite linear;
            z-index: 0;
        }

        @keyframes pulse {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .logo {
            margin-bottom: 40px;
            text-align: center;
            z-index: 1;
            position: relative;
        }

        .logo h1 {
            color: white;
            font-size: 3.5rem;
            font-weight: 700;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(45deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-form {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            z-index: 1;
            position: relative;
            transition: all 0.3s ease;
        }

        .login-form:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .login-form h2 {
            margin-bottom: 24px;
            text-align: center;
            color: white;
            font-weight: 600;
            font-size: 1.8rem;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 15px 20px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 106, 255, 0.2);
            background-color: white;
        }

        .btn-primary, .btn-secondary, .btn-tertiary {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 106, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 106, 255, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: white;
        }

        .btn-tertiary {
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-tertiary:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
        }

        /* Registration Form */
        .registration-form {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            z-index: 1;
            position: relative;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .registration-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .gender-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .gender-option {
            flex: 1;
            text-align: center;
        }

        .gender-option input {
            display: none;
        }

        .gender-option label {
            display: block;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .gender-option input:checked + label {
            border-color: white;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main App */
        .navbar {
            background: var(--gradient-primary);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            height: 70px;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-logo h2 {
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: white;
            transition: width 0.3s ease;
        }

        .nav-btn.active, .nav-btn:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-btn.active::after, .nav-btn:hover::after {
            width: 100%;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-user span {
            font-weight: 500;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-name-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .edit-name-btn:hover {
            transform: scale(1.2);
        }

        .music-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }

        .music-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }

        .coins-display {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--warning-color);
            font-weight: 600;
            padding: 5px 10px;
            background: rgba(255, 215, 64, 0.2);
            border-radius: 10px;
        }

        /* Main Content */
        .main-content {
            padding: 30px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.5s ease;
        }

        .page-title {
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
        }

        /* Games Grid */
        .games-grid, .clouds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .game-card, .cloud-card {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .game-card:hover, .cloud-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .game-card img, .cloud-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .game-card:hover img, .cloud-card:hover img {
            transform: scale(1.05);
        }

        .game-info, .cloud-info {
            padding: 15px;
        }

        .game-info h3, .cloud-info h3 {
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .cloud-stats {
            display: flex;
            gap: 10px;
        }

        .like-btn, .dislike-btn {
            padding: 5px 10px;
            border: 1px solid var(--border-color);
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .like-btn.active, .dislike-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .like-btn.disabled, .dislike-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .vote-cooldown {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
            text-align: center;
        }

        /* Settings */
        .settings-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .account-card {
            display: flex;
            align-items: center;
            gap: 20px;
            background: var(--gradient-card);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .avatar {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .avatar:hover img {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 106, 255, 0.3);
        }

        .avatar-upload {
            position: absolute;
            bottom: 5px;
            right: 5px;
        }

        .avatar-upload-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .avatar-upload-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .avatar-upload-btn span {
            font-size: 16px;
            color: white;
        }

        .account-info {
            flex: 1;
        }

        .account-info h3 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .diamonds {
            color: var(--warning-color);
            font-weight: 600;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--secondary-color);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .navigation-section {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin: 20px 0;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .navigation-section h3 {
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.2rem;
        }

        .navigation-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .nav-direction-btn {
            padding: 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-direction-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .nav-direction-btn.active {
            background: var(--secondary-color);
        }

        .floating-nav {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--gradient-card);
            border-radius: 15px;
            box-shadow: var(--shadow);
            z-index: 999;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            padding: 10px;
            transition: all 0.3s ease;
        }

        .floating-nav.minimized {
            height: 40px;
            overflow: hidden;
        }

        .floating-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .floating-nav-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 5px;
        }

        .floating-nav-btn:hover {
            background: var(--primary-dark);
        }

        .floating-nav-btn.active {
            background: var(--secondary-color);
        }

        .lock-btn {
            background: var(--warning-color) !important;
        }

        .lock-btn.locked {
            background: var(--danger-color) !important;
        }

        .hide-btn {
            background: var(--text-secondary) !important;
        }

        .zalo-group {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--gradient-card);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin: 20px 0;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .group-avatar img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
        }

        .group-info {
            flex: 1;
        }

        .group-info h4 {
            margin-bottom: 10px;
        }

        .join-btn {
            width: auto;
            padding: 8px 16px;
        }

        /* Social Links */
        .social-links {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: var(--gradient-card);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            overflow: hidden;
        }

        .social-link img {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .social-link:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Daily Login */
        .daily-login {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin: 20px 0;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
        }

        .daily-login h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .daily-calendar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .day-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: var(--light-color);
            transition: all 0.3s ease;
            flex: 1;
            margin: 0 5px;
        }

        .day-item.active {
            background: var(--primary-color);
            color: white;
        }

        .day-item.claimed {
            background: var(--success-color);
            color: white;
        }

        .day-name {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .day-coins {
            font-size: 14px;
            font-weight: 600;
        }

        .daily-actions {
            display: flex;
            gap: 10px;
        }

        .daily-actions input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--card-background);
            color: var(--text-primary);
            font-size: 14px;
        }

        .daily-actions input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 106, 255, 0.2);
        }

        /* Popups */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .popup-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow);
            text-align: center;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .popup-overlay.active .popup-content {
            transform: scale(1);
        }

        .popup-avatar {
            margin-bottom: 20px;
        }

        .popup-avatar img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
        }

        .popup-content h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .popup-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .popup-buttons button {
            flex: 1;
        }

        .popup-notification label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .game-detail-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* Music Player */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 999;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.5s ease;
        }

        .music-player.active {
            transform: translateY(0);
            opacity: 1;
        }

        .music-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .music-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
        }

        .music-url-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .music-url-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-background);
            color: var(--text-primary);
        }

        .music-url-input button {
            padding: 10px 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-url-input button:hover {
            background: var(--primary-dark);
        }

        .music-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .music-buttons button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .music-buttons button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .music-buttons button.active {
            background: var(--secondary-color);
        }

        .music-toggle {
            display: flex;
            justify-content: center;
            padding: 10px;
            border-top: 1px solid var(--border-color);
        }

        /* Chat System */
        .chat-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            z-index: 999;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            transform: translateX(-400px);
            transition: transform 0.5s ease;
        }

        .chat-container.active {
            transform: translateX(0);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-close-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-close-btn:hover {
            transform: scale(1.2);
        }

        .chat-menu-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .chat-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background: var(--primary-color);
            color: white;
        }

        .bot-message {
            align-self: flex-start;
            background: var(--card-background);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .chat-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid var(--border-color);
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--card-background);
            color: var(--text-primary);
        }

        .chat-input button {
            margin-left: 10px;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: var(--primary-dark);
        }

        .chat-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Chat Menu */
        .chat-menu {
            position: absolute;
            top: 50px;
            right: 10px;
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 10px;
            min-width: 150px;
            z-index: 1000;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            display: none;
        }

        .chat-menu.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .chat-menu-item {
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .chat-menu-item:hover {
            background: rgba(0, 106, 255, 0.1);
        }

        .chat-footer {
            padding: 10px;
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
        }

        /* Name Edit Popup */
        .name-edit-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .name-edit-popup.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .name-edit-content {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow);
            text-align: center;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        /* Developer Mode */
        .dev-container {
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .dev-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: var(--gradient-primary);
            color: white;
        }

        .dev-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .btn-close {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .dev-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            background: var(--card-background);
        }

        .dev-tab {
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .dev-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .dev-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .dev-tab-content {
            display: none;
        }

        .dev-tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .dev-tab-content h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .dev-tab-content .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .dev-tab-content .input-group input {
            flex: 1;
            min-width: 200px;
        }

        .dev-tab-content .input-group button {
            width: auto;
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--light-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item:hover {
            background: rgba(0, 106, 255, 0.1);
        }

        .item.selected {
            background: rgba(0, 106, 255, 0.2);
            border: 1px solid var(--primary-color);
        }

        .item img {
            width: 60px;
            height: 40px;
            object-fit: cover;
            border-radius: 6px;
        }

        .item-info {
            flex: 1;
        }

        .item-info h4 {
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .item-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .cloud-stats-small {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }

        .cloud-stats-small span {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .delete-btn {
            padding: 5px 10px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #ff1a1a;
            transform: scale(1.05);
        }

        .data-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .data-actions button {
            width: auto;
        }

        /* Cloud Viewer */
        .cloud-overlay {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 300px;
            background: var(--gradient-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: none;
            flex-direction: column;
            z-index: 999;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .cloud-overlay.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .cloud-overlay.minimized {
            height: 40px;
            overflow: hidden;
        }

        .cloud-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .cloud-controls {
            display: flex;
            gap: 5px;
        }

        .cloud-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cloud-time {
            font-size: 12px;
            margin-right: 10px;
        }

        .cloud-content {
            flex: 1;
            overflow: hidden;
        }

        .cloud-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Empty State Styles */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 18px;
            margin: 0;
        }

        /* Checkbox Group */
        .checkbox-group {
            margin: 15px 0;
            text-align: left;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        /* Cloud Purchase Options */
        .cloud-purchase-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .purchase-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--light-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .purchase-option:hover {
            background: rgba(0, 106, 255, 0.1);
        }

        .purchase-option.selected {
            background: rgba(0, 106, 255, 0.2);
            border: 1px solid var(--primary-color);
        }

        .purchase-info {
            display: flex;
            flex-direction: column;
        }

        .purchase-duration {
            font-weight: 600;
        }

        .purchase-price {
            color: var(--warning-color);
            font-weight: 600;
        }

        /* Floating Nav Images */
        .floating-nav-img {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                height: auto;
                padding: 15px;
            }

            .nav-menu {
                margin: 15px 0;
            }

            .nav-user {
                margin-top: 10px;
            }

            .games-grid, .clouds-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .account-card {
                flex-direction: column;
                text-align: center;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            .avatar-upload-btn {
                width: 28px;
                height: 28px;
            }

            .avatar-upload-btn span {
                font-size: 14px;
            }

            .popup-buttons {
                flex-direction: column;
            }

            .dev-tabs {
                flex-wrap: wrap;
            }

            .cloud-overlay {
                width: calc(100% - 40px);
                height: 50vh;
            }

            .chat-container {
                width: calc(100% - 40px);
                left: 20px;
                height: 60vh;
            }

            .music-player {
                width: calc(100% - 40px);
                right: 20px;
            }

            .daily-calendar {
                flex-wrap: wrap;
            }

            .day-item {
                flex: 0 0 calc(33.333% - 10px);
                margin-bottom: 10px;
            }

            .floating-nav {
                right: 10px;
            }

            .navigation-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .login-form {
                padding: 30px 20px;
            }

            .logo h1 {
                font-size: 2.5rem;
            }

            .games-grid, .clouds-grid {
                grid-template-columns: 1fr;
            }

            .dev-container {
                width: 95%;
            }

            .daily-calendar {
                flex-direction: column;
            }

            .day-item {
                margin-bottom: 10px;
            }

            .navigation-buttons {
                grid-template-columns: 1fr;
            }

            .music-player {
                width: calc(100% - 40px);
            }

            .music-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="logo">
                <h1>Game Center</h1>
            </div>
            <div class="login-form">
                <h2>Đăng nhập</h2>
                <div class="input-group">
                    <input type="text" id="username" placeholder="Tên đăng nhập">
                </div>
                <div class="input-group">
                    <input type="password" id="password" placeholder="Mật khẩu">
                </div>
                <button id="loginBtn" class="btn-primary">Đăng nhập</button>
                <button id="registerBtn" class="btn-secondary">Đăng ký</button>
                <button id="guestBtn" class="btn-tertiary">Tiếp tục với tư cách khách</button>
            </div>
            
            <!-- Registration Form -->
            <div class="registration-form" id="registrationForm">
                <h2>Đăng ký tài khoản</h2>
                <div class="input-group">
                    <input type="text" id="regUsername" placeholder="Tên đăng nhập">
                </div>
                <div class="input-group">
                    <input type="password" id="regPassword" placeholder="Mật khẩu">
                </div>
                <div class="input-group">
                    <input type="password" id="confirmPassword" placeholder="Xác nhận mật khẩu">
                </div>
                <div class="gender-selection">
                    <div class="gender-option">
                        <input type="radio" id="male" name="gender" value="male">
                        <label for="male">Nam</label>
                    </div>
                    <div class="gender-option">
                        <input type="radio" id="female" name="gender" value="female">
                        <label for="female">Nữ</label>
                    </div>
                </div>
                <button id="createAccountBtn" class="btn-primary">Tạo tài khoản</button>
                <button id="backToLoginBtn" class="btn-tertiary">Quay lại đăng nhập</button>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="screen">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <h2>Game Center</h2>
                </div>
                <div class="nav-menu">
                    <button class="nav-btn active" data-page="download">Download</button>
                    <button class="nav-btn" data-page="cloud">Cloud</button>
                    <button class="nav-btn" id="chatBtn">Chat</button>
                    <button class="nav-btn" data-page="settings">Settings</button>
                </div>
                <div class="nav-user">
                    <span id="userDisplay">Admin <button class="edit-name-btn" id="editNameBtn">✏️</button></span>
                    <div class="coins-display" id="coinsDisplay">💰 0</div>
                    <button class="music-btn" id="musicToggleBtn">🎵</button>
                </div>
            </div>
        </nav>

        <!-- Pages -->
        <main class="main-content">
            <!-- Download Page -->
            <div id="downloadPage" class="page active">
                <h2 class="page-title">Game Download</h2>
                <div class="games-grid" id="gamesGrid">
                    <!-- Games will be loaded here -->
                </div>
            </div>

            <!-- Cloud Page -->
            <div id="cloudPage" class="page">
                <h2 class="page-title">Cloud</h2>
                <div class="clouds-grid" id="cloudsGrid">
                    <!-- Clouds will be loaded here -->
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="page">
                <h2 class="page-title">Cài đặt</h2>
                <div class="settings-container">
                    <div class="account-card">
                        <div class="avatar">
                            <img id="accountAvatar" src="https://cdn2.fptshop.com.vn/small/avatar_trang_1_cd729c335b.jpg" alt="Avatar">
                            <div class="avatar-upload">
                                <label for="avatarUpload" class="avatar-upload-btn">
                                    <span>📷</span>
                                </label>
                                <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <div class="account-info">
                            <h3 id="accountName">Admin <button class="edit-name-btn" id="editNameBtn2">✏️</button></h3>
                            <p class="diamonds" id="accountDiamonds">9999 Kim cương</p>
                        </div>
                    </div>

                    <div class="setting-item">
                        <label for="themeSwitch">Chế độ tối</label>
                        <label class="switch">
                            <input type="checkbox" id="themeSwitch">
                            <span class="slider"></span>
                        </label>
                    </div>

                    <!-- Navigation Section -->
                    <div class="navigation-section">
                        <h3>Điều hướng</h3>
                        <div class="navigation-buttons">
                            <button class="nav-direction-btn" id="navTopBtn">Trên</button>
                            <button class="nav-direction-btn" id="navBottomBtn">Dưới</button>
                            <button class="nav-direction-btn" id="navRightBtn">Phải</button>
                            <button class="nav-direction-btn" id="navLeftBtn">Trái</button>
                            <button class="nav-direction-btn" id="navFloatBtn">Nổi</button>
                        </div>
                    </div>

                    <!-- Social Links -->
                    <div class="social-links">
                        <div class="social-link" id="youtubeLink">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/2560px-YouTube_full-color_icon_%282017%29.svg.png" alt="YouTube">
                        </div>
                        <div class="social-link" id="zaloLink">
                            <img src="https://upload.wikimedia.org/wikipedia/vi/thumb/f/f6/Zalo_logo.png/640px-Zalo_logo.png" alt="Zalo">
                        </div>
                        <div class="social-link" id="facebookLink">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Facebook_f_logo_%282019%29.svg/2048px-Facebook_f_logo_%282019%29.svg.png" alt="Facebook">
                        </div>
                    </div>

                    <!-- Daily Login -->
                    <div class="daily-login">
                        <h3>Đăng nhập hàng ngày</h3>
                        <div class="daily-calendar" id="dailyCalendar">
                            <!-- Days will be populated by JavaScript -->
                        </div>
                        <div class="daily-actions">
                            <input type="text" id="codeInput" placeholder="Nhập mã code để nhận xu">
                            <button id="claimCodeBtn" class="btn-primary">Nhận xu</button>
                        </div>
                    </div>

                    <div class="zalo-group">
                        <div class="group-avatar">
                            <img src="https://files.catbox.moe/mlq4is.jpg" alt="Zalo Group">
                        </div>
                        <div class="group-info">
                            <h4>Nhóm Zalo Game Center</h4>
                            <button class="btn-primary join-btn">Tham gia</button>
                        </div>
                    </div>

                    <div class="zalo-group">
                        <div class="group-avatar">
                            <img src="https://files.catbox.moe/mlq4is.jpg" alt="Zalo Group">
                        </div>
                        <div class="group-info">
                            <h4>Nhóm Zalo Game Center 2</h4>
                            <button class="btn-primary join-btn">Tham gia</button>
                        </div>
                    </div>

                    <button id="devModeBtn" class="btn-secondary">Chế độ phát triển</button>
                    <button id="logoutBtn" class="btn-tertiary">Đăng xuất</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Floating Navigation -->
    <div id="floatingNav" class="floating-nav">
        <div class="floating-nav-header">
            <button class="floating-nav-btn lock-btn" id="navLockBtn">🔒</button>
            <button class="floating-nav-btn hide-btn" id="navHideBtn">^</button>
        </div>
        <button class="floating-nav-btn" data-page="download">
            <img src="https://cdn-icons-png.flaticon.com/512/724/724933.png" alt="Download" class="floating-nav-img">
        </button>
        <button class="floating-nav-btn" data-page="cloud">
            <img src="https://cdn-icons-png.flaticon.com/512/1163/1163734.png" alt="Cloud" class="floating-nav-img">
        </button>
        <button class="floating-nav-btn" id="floatingChatBtn">
            <img src="https://cdn-icons-png.flaticon.com/512/2462/2462719.png" alt="Chat" class="floating-nav-img">
        </button>
        <button class="floating-nav-btn" data-page="settings">
            <img src="https://cdn-icons-png.flaticon.com/512/2099/2099153.png" alt="Settings" class="floating-nav-img">
        </button>
    </div>

    <!-- Welcome Popup -->
    <div id="welcomePopup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-avatar">
                <img id="popupAvatar" src="https://files.catbox.moe/mlq4is.jpg" alt="Avatar">
            </div>
            <h3>Bạn đã tham gia nhóm Roblox chưa?</h3>
            <div class="popup-buttons">
                <button id="notJoinedBtn" class="btn-primary">Chưa tham gia</button>
                <button id="alreadyJoinedBtn" class="btn-secondary">Đã tham gia</button>
            </div>
            <div class="popup-notification">
                <label>
                    <input type="checkbox" id="disableNotification">
                    Tắt thông báo trong 2 giờ
                </label>
            </div>
        </div>
    </div>

    <!-- Game Detail Popup -->
    <div id="gameDetailPopup" class="popup-overlay">
        <div class="popup-content">
            <img id="gameDetailImage" src="" alt="Game Image" class="game-detail-img">
            <h3 id="gameDetailTitle"></h3>
            <p>Bạn có muốn download game này không?</p>
            <div class="popup-buttons">
                <button id="downloadGameBtn" class="btn-primary">Download</button>
                <button id="cancelDownloadBtn" class="btn-secondary">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Name Edit Popup -->
    <div id="nameEditPopup" class="name-edit-popup">
        <div class="name-edit-content">
            <h3>Đổi tên hiển thị</h3>
            <div class="input-group">
                <input type="text" id="newNameInput" placeholder="Nhập tên mới">
            </div>
            <div class="popup-buttons">
                <button id="saveNameBtn" class="btn-primary">Lưu</button>
                <button id="cancelNameBtn" class="btn-secondary">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Cloud Purchase Popup -->
    <div id="cloudPurchasePopup" class="popup-overlay">
        <div class="popup-content">
            <h3 id="cloudPurchaseTitle">Mua Cloud</h3>
            <p>Chọn gói thời gian sử dụng:</p>
            <div class="cloud-purchase-options">
                <div class="purchase-option" data-duration="6" data-price="50">
                    <div class="purchase-info">
                        <div class="purchase-duration">6 giờ</div>
                    </div>
                    <div class="purchase-price">50 xu</div>
                </div>
                <div class="purchase-option" data-duration="12" data-price="150">
                    <div class="purchase-info">
                        <div class="purchase-duration">12 giờ</div>
                    </div>
                    <div class="purchase-price">150 xu</div>
                </div>
                <div class="purchase-option" data-duration="24" data-price="299">
                    <div class="purchase-info">
                        <div class="purchase-duration">24 giờ</div>
                    </div>
                    <div class="purchase-price">299 xu</div>
                </div>
                <div class="purchase-option" data-duration="infinite" data-price="999">
                    <div class="purchase-info">
                        <div class="purchase-duration">Vô hạn</div>
                    </div>
                    <div class="purchase-price">999 xu</div>
                </div>
            </div>
            <div class="popup-buttons">
                <button id="confirmPurchaseBtn" class="btn-primary">Mua ngay</button>
                <button id="cancelPurchaseBtn" class="btn-secondary">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Popup -->
    <div id="logoutConfirmPopup" class="popup-overlay">
        <div class="popup-content">
            <h3>Xác nhận đăng xuất</h3>
            <p>Bạn có chắc chắn muốn đăng xuất?</p>
            <div class="popup-buttons">
                <button id="confirmLogoutBtn" class="btn-primary">Có</button>
                <button id="cancelLogoutBtn" class="btn-secondary">Không</button>
            </div>
        </div>
    </div>

    <!-- Music Player -->
    <div id="musicPlayer" class="music-player">
        <div class="music-header">
            <h3>Music Player</h3>
            <button id="closeMusicBtn" class="btn-close">×</button>
        </div>
        <div class="music-controls">
            <div class="music-url-input">
                <input type="text" id="musicUrlInput" placeholder="Nhập URL nhạc hoặc tìm kiếm">
                <button id="playUrlBtn">Phát</button>
            </div>
            <div class="music-buttons">
                <button id="music1" class="btn-primary">Nhạc 1</button>
                <button id="music2" class="btn-primary">Nhạc 2</button>
                <button id="music3" class="btn-primary">Nhạc 3</button>
                <button id="music4" class="btn-primary">Nhạc 4</button>
                <button id="music5" class="btn-primary">Nhạc 5</button>
                <button id="musicSearchBtn" class="btn-primary">Tìm kiếm</button>
            </div>
        </div>
        <div class="music-toggle">
            <button id="musicOffBtn" class="btn-secondary">Tắt nhạc</button>
        </div>
    </div>

    <!-- Chat System -->
    <div id="chatContainer" class="chat-container">
        <div class="chat-header">
            <div class="chat-title">
                <button class="chat-close-btn" id="chatCloseBtn">×</button>
                <h3 id="chatTitle">Chat với Bot</h3>
            </div>
            <button class="chat-menu-btn" id="chatMenuBtn">☰</button>
        </div>
        <div class="chat-content" id="chatContent">
            <!-- Messages will be added here -->
        </div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Nhập tin nhắn...">
            <button id="sendMessageBtn">Gửi</button>
        </div>
        <div class="chat-footer">
            <p>cree Tuann</p>
        </div>
        
        <!-- Chat Menu -->
        <div class="chat-menu" id="chatMenu">
            <div class="chat-menu-item" id="newChatBtn">Đoạn chat mới</div>
            <div class="chat-menu-item" id="renameChatBtn">Đổi tên đoạn chat</div>
            <div class="chat-menu-item" id="pinChatBtn">Ghim đoạn chat</div>
            <div class="chat-menu-item" id="deleteChatBtn">Xoá đoạn chat</div>
        </div>
    </div>

    <!-- Developer Mode -->
    <div id="devMode" class="popup-overlay">
        <div class="dev-container">
            <div class="dev-header">
                <h2>Chế độ phát triển</h2>
                <button id="closeDevMode" class="btn-close">×</button>
            </div>
            
            <div class="dev-tabs">
                <button class="dev-tab active" data-tab="videos">Quản lý Video</button>
                <button class="dev-tab" data-tab="games">Quản lý Game</button>
                <button class="dev-tab" data-tab="clouds">Quản lý Cloud</button>
                <button class="dev-tab" data-tab="popup">Cài đặt Popup</button>
                <button class="dev-tab" data-tab="importExport">Import/Export</button>
            </div>

            <div class="dev-content">
                <!-- Videos Tab -->
                <div id="videosTab" class="dev-tab-content active">
                    <h3>Thêm Video YouTube</h3>
                    <div class="input-group">
                        <input type="text" id="videoUrl" placeholder="Link YouTube">
                        <button id="addVideoBtn" class="btn-primary">Thêm video</button>
                    </div>
                    <div class="items-list" id="videosList">
                        <!-- Videos will be listed here -->
                    </div>
                </div>

                <!-- Games Tab -->
                <div id="gamesTab" class="dev-tab-content">
                    <h3>Thêm Game</h3>
                    <div class="input-group">
                        <input type="text" id="gameName" placeholder="Tên game">
                        <input type="text" id="gameLink" placeholder="Link download">
                        <input type="file" id="gameImage" accept="image/*">
                        <button id="addGameBtn" class="btn-primary">Thêm game</button>
                    </div>
                    <div class="items-list" id="gamesList">
                        <!-- Games will be listed here -->
                    </div>
                </div>

                <!-- Clouds Tab -->
                <div id="cloudsTab" class="dev-tab-content">
                    <h3>Thêm Cloud</h3>
                    <div class="input-group">
                        <input type="text" id="cloudName" placeholder="Tên cloud">
                        <input type="text" id="cloudLink" placeholder="Link cloud">
                        <input type="file" id="cloudImage" accept="image/*">
                        <button id="addCloudBtn" class="btn-primary">Thêm cloud</button>
                    </div>
                    <div class="items-list" id="cloudsList">
                        <!-- Clouds will be listed here -->
                    </div>
                </div>

                <!-- Popup Tab -->
                <div id="popupTab" class="dev-tab-content">
                    <h3>Cài đặt Popup</h3>
                    <div class="input-group">
                        <input type="file" id="popupAvatarInput" accept="image/*">
                        <input type="text" id="popupLink" placeholder="Link chuyển hướng">
                        <input type="text" id="groupLink" placeholder="Link nhóm">
                        <button id="savePopupBtn" class="btn-primary">Lưu cài đặt</button>
                    </div>
                </div>

                <!-- Import/Export Tab -->
                <div id="importExportTab" class="dev-tab-content">
                    <h3>Quản lý dữ liệu</h3>
                    <div class="data-actions">
                        <button id="exportDataBtn" class="btn-primary">Export JSON</button>
                        <input type="file" id="importDataInput" accept=".json">
                        <button id="importDataBtn" class="btn-secondary">Import JSON</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cloud Viewer Overlay -->
    <div id="cloudViewer" class="cloud-overlay">
        <div class="cloud-header">
            <span id="cloudViewerTitle">Cloud Viewer</span>
            <div class="cloud-controls">
                <span class="cloud-time" id="cloudTime">00:00:00</span>
                <button id="minimizeCloud" class="cloud-btn">_</button>
                <button id="closeCloud" class="cloud-btn">×</button>
            </div>
        </div>
        <div class="cloud-content">
            <iframe id="cloudFrame" src="" frameborder="0"></iframe>
        </div>
    </div>

    <!-- Dev Login -->
    <div id="devLogin" class="popup-overlay">
        <div class="popup-content">
            <h3>Đăng nhập chế độ phát triển</h3>
            <div class="input-group">
                <input type="password" id="devPassword" placeholder="Mật khẩu">
            </div>
            <div class="checkbox-group">
                <label>
                    <input type="checkbox" id="rememberDev">
                    Lưu đăng nhập
                </label>
            </div>
            <div class="popup-buttons">
                <button id="confirmDevLogin" class="btn-primary">Xác nhận</button>
                <button id="cancelDevLogin" class="btn-secondary">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Audio Element for Music -->
    <audio id="backgroundMusic" loop>
        <source src="" type="audio/mpeg">
    </audio>

    <script>
        // Global state
        let appState = {
            currentUser: null,
            isLoggedIn: false,
            isGuest: false,
            theme: localStorage.getItem('theme') || 'light',
            currentPage: 'download',
            devMode: false,
            cloudViewer: {
                isOpen: false,
                isMinimized: false,
                currentCloud: null,
                remainingTime: 0,
                timer: null
            },
            welcomePopup: {
                show: true,
                disabledUntil: null
            },
            music: {
                isPlaying: false,
                currentTrack: null,
                volume: 0.5
            },
            chat: {
                isOpen: false,
                currentChat: 'default',
                history: {},
                isBotTyping: false
            },
            coins: parseInt(localStorage.getItem('coins')) || 0,
            dailyLogin: JSON.parse(localStorage.getItem('dailyLogin')) || {
                lastClaimed: null,
                streak: 0
            },
            purchasedClouds: JSON.parse(localStorage.getItem('purchasedClouds')) || {},
            navigation: {
                position: 'right',
                floatingNavLocked: false,
                floatingNavVisible: true
            }
        };

        // DOM Elements
        const elements = {
            // Screens
            loginScreen: document.getElementById('loginScreen'),
            mainApp: document.getElementById('mainApp'),
            
            // Login
            username: document.getElementById('username'),
            password: document.getElementById('password'),
            loginBtn: document.getElementById('loginBtn'),
            registerBtn: document.getElementById('registerBtn'),
            guestBtn: document.getElementById('guestBtn'),
            
            // Registration
            registrationForm: document.getElementById('registrationForm'),
            regUsername: document.getElementById('regUsername'),
            regPassword: document.getElementById('regPassword'),
            confirmPassword: document.getElementById('confirmPassword'),
            createAccountBtn: document.getElementById('createAccountBtn'),
            backToLoginBtn: document.getElementById('backToLoginBtn'),
            
            // Navigation
            navBtns: document.querySelectorAll('.nav-btn[data-page]'),
            userDisplay: document.getElementById('userDisplay'),
            coinsDisplay: document.getElementById('coinsDisplay'),
            logoutBtn: document.getElementById('logoutBtn'),
            editNameBtn: document.getElementById('editNameBtn'),
            editNameBtn2: document.getElementById('editNameBtn2'),
            musicToggleBtn: document.getElementById('musicToggleBtn'),
            chatBtn: document.getElementById('chatBtn'),
            
            // Pages
            downloadPage: document.getElementById('downloadPage'),
            cloudPage: document.getElementById('cloudPage'),
            settingsPage: document.getElementById('settingsPage'),
            
            // Content containers
            gamesGrid: document.getElementById('gamesGrid'),
            cloudsGrid: document.getElementById('cloudsGrid'),
            
            // Settings
            accountName: document.getElementById('accountName'),
            accountAvatar: document.getElementById('accountAvatar'),
            accountDiamonds: document.getElementById('accountDiamonds'),
            themeSwitch: document.getElementById('themeSwitch'),
            devModeBtn: document.getElementById('devModeBtn'),
            avatarUpload: document.getElementById('avatarUpload'),
            
            // Navigation buttons
            navTopBtn: document.getElementById('navTopBtn'),
            navBottomBtn: document.getElementById('navBottomBtn'),
            navRightBtn: document.getElementById('navRightBtn'),
            navLeftBtn: document.getElementById('navLeftBtn'),
            navFloatBtn: document.getElementById('navFloatBtn'),
            
            // Floating navigation
            floatingNav: document.getElementById('floatingNav'),
            navLockBtn: document.getElementById('navLockBtn'),
            navHideBtn: document.getElementById('navHideBtn'),
            floatingNavBtns: document.querySelectorAll('.floating-nav-btn[data-page]'),
            floatingChatBtn: document.getElementById('floatingChatBtn'),
            
            // Social Links
            youtubeLink: document.getElementById('youtubeLink'),
            zaloLink: document.getElementById('zaloLink'),
            facebookLink: document.getElementById('facebookLink'),
            
            // Daily Login
            dailyCalendar: document.getElementById('dailyCalendar'),
            codeInput: document.getElementById('codeInput'),
            claimCodeBtn: document.getElementById('claimCodeBtn'),
            
            // Popups
            welcomePopup: document.getElementById('welcomePopup'),
            notJoinedBtn: document.getElementById('notJoinedBtn'),
            alreadyJoinedBtn: document.getElementById('alreadyJoinedBtn'),
            disableNotification: document.getElementById('disableNotification'),
            
            gameDetailPopup: document.getElementById('gameDetailPopup'),
            gameDetailImage: document.getElementById('gameDetailImage'),
            gameDetailTitle: document.getElementById('gameDetailTitle'),
            downloadGameBtn: document.getElementById('downloadGameBtn'),
            cancelDownloadBtn: document.getElementById('cancelDownloadBtn'),
            
            nameEditPopup: document.getElementById('nameEditPopup'),
            newNameInput: document.getElementById('newNameInput'),
            saveNameBtn: document.getElementById('saveNameBtn'),
            cancelNameBtn: document.getElementById('cancelNameBtn'),
            
            cloudPurchasePopup: document.getElementById('cloudPurchasePopup'),
            cloudPurchaseTitle: document.getElementById('cloudPurchaseTitle'),
            confirmPurchaseBtn: document.getElementById('confirmPurchaseBtn'),
            cancelPurchaseBtn: document.getElementById('cancelPurchaseBtn'),
            
            logoutConfirmPopup: document.getElementById('logoutConfirmPopup'),
            confirmLogoutBtn: document.getElementById('confirmLogoutBtn'),
            cancelLogoutBtn: document.getElementById('cancelLogoutBtn'),
            
            // Music Player
            musicPlayer: document.getElementById('musicPlayer'),
            closeMusicBtn: document.getElementById('closeMusicBtn'),
            musicUrlInput: document.getElementById('musicUrlInput'),
            playUrlBtn: document.getElementById('playUrlBtn'),
            music1: document.getElementById('music1'),
            music2: document.getElementById('music2'),
            music3: document.getElementById('music3'),
            music4: document.getElementById('music4'),
            music5: document.getElementById('music5'),
            musicSearchBtn: document.getElementById('musicSearchBtn'),
            musicOffBtn: document.getElementById('musicOffBtn'),
            backgroundMusic: document.getElementById('backgroundMusic'),
            
            // Chat System
            chatContainer: document.getElementById('chatContainer'),
            chatTitle: document.getElementById('chatTitle'),
            chatContent: document.getElementById('chatContent'),
            chatInput: document.getElementById('chatInput'),
            sendMessageBtn: document.getElementById('sendMessageBtn'),
            chatCloseBtn: document.getElementById('chatCloseBtn'),
            chatMenuBtn: document.getElementById('chatMenuBtn'),
            chatMenu: document.getElementById('chatMenu'),
            newChatBtn: document.getElementById('newChatBtn'),
            renameChatBtn: document.getElementById('renameChatBtn'),
            pinChatBtn: document.getElementById('pinChatBtn'),
            deleteChatBtn: document.getElementById('deleteChatBtn'),
            
            // Developer Mode
            devMode: document.getElementById('devMode'),
            closeDevMode: document.getElementById('closeDevMode'),
            devTabs: document.querySelectorAll('.dev-tab'),
            devTabContents: document.querySelectorAll('.dev-tab-content'),
            
            // Dev - Videos
            videoUrl: document.getElementById('videoUrl'),
            addVideoBtn: document.getElementById('addVideoBtn'),
            videosList: document.getElementById('videosList'),
            
            // Dev - Games
            gameName: document.getElementById('gameName'),
            gameLink: document.getElementById('gameLink'),
            gameImage: document.getElementById('gameImage'),
            addGameBtn: document.getElementById('addGameBtn'),
            gamesList: document.getElementById('gamesList'),
            
            // Dev - Clouds
            cloudName: document.getElementById('cloudName'),
            cloudLink: document.getElementById('cloudLink'),
            cloudImage: document.getElementById('cloudImage'),
            addCloudBtn: document.getElementById('addCloudBtn'),
            cloudsList: document.getElementById('cloudsList'),
            
            // Dev - Popup
            popupAvatarInput: document.getElementById('popupAvatarInput'),
            popupLink: document.getElementById('popupLink'),
            groupLink: document.getElementById('groupLink'),
            savePopupBtn: document.getElementById('savePopupBtn'),
            
            // Dev - Import/Export
            exportDataBtn: document.getElementById('exportDataBtn'),
            importDataInput: document.getElementById('importDataInput'),
            importDataBtn: document.getElementById('importDataBtn'),
            
            // Dev Login
            devLogin: document.getElementById('devLogin'),
            devPassword: document.getElementById('devPassword'),
            rememberDev: document.getElementById('rememberDev'),
            confirmDevLogin: document.getElementById('confirmDevLogin'),
            cancelDevLogin: document.getElementById('cancelDevLogin'),
            
            // Cloud Viewer
            cloudViewer: document.getElementById('cloudViewer'),
            cloudViewerTitle: document.getElementById('cloudViewerTitle'),
            cloudFrame: document.getElementById('cloudFrame'),
            cloudTime: document.getElementById('cloudTime'),
            minimizeCloud: document.getElementById('minimizeCloud'),
            closeCloud: document.getElementById('closeCloud')
        };

        // Default avatar URL
        const DEFAULT_AVATAR_URL = "https://cdn2.fptshop.com.vn/small/avatar_trang_1_cd729c335b.jpg";

        // Like/Dislike cooldown time (10 minutes in milliseconds)
        const VOTE_COOLDOWN = 10 * 60 * 1000;

        // Music tracks
        const MUSIC_TRACKS = {
            track1: "https://github.com/Tuanndz/RBL_DL/blob/main/cause%20i%20love%20you.mp3",
            track2: "https://github.com/Tuanndz/RBL_DL/blob/main/thegiantinh.mp3",
            track3: "https://github.com/Tuanndz/RBL_DL/blob/main/toichocogaido.mp3",
        };

        // Gemini API Key
        const GEMINI_API_KEY = "AIzaSyBLygFLTPw_Z21dfhj8Vs0CCOiZFzzJin8";

        // Daily login rewards
        const DAILY_REWARDS = {
            0: 20, // Monday
            1: 35, // Tuesday
            2: 55, // Wednesday
            3: 72, // Thursday
            4: 89, // Friday
            5: 100, // Saturday
            6: 125  // Sunday
        };

        // Cloud purchase options
        const CLOUD_PURCHASE_OPTIONS = [
            { duration: 6, price: 50 },
            { duration: 12, price: 150 },
            { duration: 24, price: 299 },
            { duration: 'infinite', price: 999 }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthState();
            loadChatHistory();
            updateCoinsDisplay();
            setupDailyLogin();
            setupNavigation();
        });

        function initializeApp() {
            // Apply theme
            applyTheme(appState.theme);
            
            // Check if welcome popup should be shown
            checkWelcomePopup();
            
            // Initialize music
            elements.backgroundMusic.volume = appState.music.volume;
            
            // Check for active cloud sessions
            checkActiveCloudSessions();
            
            // Load navigation settings
            loadNavigationSettings();
        }

        function setupEventListeners() {
            // Login events
            elements.loginBtn.addEventListener('click', handleLogin);
            elements.registerBtn.addEventListener('click', showRegistrationForm);
            elements.guestBtn.addEventListener('click', handleGuestLogin);
            
            // Registration events
            elements.createAccountBtn.addEventListener('click', handleRegister);
            elements.backToLoginBtn.addEventListener('click', hideRegistrationForm);
            
            // Navigation events
            elements.navBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchPage(e.target.dataset.page);
                });
            });
            
            elements.logoutBtn.addEventListener('click', showLogoutConfirm);
            elements.confirmLogoutBtn.addEventListener('click', handleLogout);
            elements.cancelLogoutBtn.addEventListener('click', () => {
                hidePopup(elements.logoutConfirmPopup);
            });
            
            // Settings events
            elements.themeSwitch.addEventListener('change', toggleTheme);
            elements.devModeBtn.addEventListener('click', openDevLogin);
            elements.avatarUpload.addEventListener('change', handleAvatarUpload);
            
            // Navigation buttons events
            elements.navTopBtn.addEventListener('click', () => setNavigationPosition('top'));
            elements.navBottomBtn.addEventListener('click', () => setNavigationPosition('bottom'));
            elements.navRightBtn.addEventListener('click', () => setNavigationPosition('right'));
            elements.navLeftBtn.addEventListener('click', () => setNavigationPosition('left'));
            elements.navFloatBtn.addEventListener('click', toggleFloatingNav);
            
            // Floating navigation events
            elements.navLockBtn.addEventListener('click', toggleFloatingNavLock);
            elements.navHideBtn.addEventListener('click', toggleFloatingNavVisibility);
            elements.floatingNavBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchPage(e.target.dataset.page);
                });
            });
            elements.floatingChatBtn.addEventListener('click', toggleChat);
            
            // Social links events
            elements.youtubeLink.addEventListener('click', () => {
                window.open('https://youtube.com', '_blank');
            });
            
            elements.zaloLink.addEventListener('click', () => {
                window.open('https://zalo.me', '_blank');
            });
            
            elements.facebookLink.addEventListener('click', () => {
                window.open('https://facebook.com', '_blank');
            });
            
            // Daily login events
            elements.claimCodeBtn.addEventListener('click', claimCode);
            
            // Name edit events
            elements.editNameBtn.addEventListener('click', showNameEditPopup);
            elements.editNameBtn2.addEventListener('click', showNameEditPopup);
            elements.saveNameBtn.addEventListener('click', saveName);
            elements.cancelNameBtn.addEventListener('click', hideNameEditPopup);
            
            // Music events
            elements.musicToggleBtn.addEventListener('click', toggleMusicPlayer);
            elements.closeMusicBtn.addEventListener('click', hideMusicPlayer);
            elements.playUrlBtn.addEventListener('click', playMusicFromUrl);
            elements.musicUrlInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') playMusicFromUrl();
            });
            elements.music1.addEventListener('click', () => playMusic('track1'));
            elements.music2.addEventListener('click', () => playMusic('track2'));
            elements.music3.addEventListener('click', () => playMusic('track3'));
            elements.music4.addEventListener('click', () => playMusic('track4'));
            elements.music5.addEventListener('click', () => playMusic('track5'));
            elements.musicSearchBtn.addEventListener('click', searchMusic);
            elements.musicOffBtn.addEventListener('click', stopMusic);
            
            // Chat events
            elements.chatBtn.addEventListener('click', toggleChat);
            elements.chatCloseBtn.addEventListener('click', toggleChat);
            elements.sendMessageBtn.addEventListener('click', sendMessage);
            elements.chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            elements.chatMenuBtn.addEventListener('click', toggleChatMenu);
            elements.newChatBtn.addEventListener('click', createNewChat);
            elements.renameChatBtn.addEventListener('click', renameChat);
            elements.pinChatBtn.addEventListener('click', pinChat);
            elements.deleteChatBtn.addEventListener('click', deleteChat);
            
            // Welcome popup events
            elements.notJoinedBtn.addEventListener('click', () => {
                window.open('#', '_blank');
                hideWelcomePopup();
            });
            
            elements.alreadyJoinedBtn.addEventListener('click', hideWelcomePopup);
            
            // Game detail popup events
            elements.downloadGameBtn.addEventListener('click', downloadCurrentGame);
            elements.cancelDownloadBtn.addEventListener('click', () => {
                hidePopup(elements.gameDetailPopup);
            });
            
            // Cloud purchase events
            elements.confirmPurchaseBtn.addEventListener('click', confirmCloudPurchase);
            elements.cancelPurchaseBtn.addEventListener('click', () => {
                hidePopup(elements.cloudPurchasePopup);
            });
            
            // Developer mode events
            elements.closeDevMode.addEventListener('click', () => {
                hidePopup(elements.devMode);
            });
            
            // Dev tab events
            elements.devTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    switchDevTab(e.target.dataset.tab);
                });
            });
            
            // Dev content management events
            elements.addVideoBtn.addEventListener('click', addVideo);
            elements.addGameBtn.addEventListener('click', addGame);
            elements.addCloudBtn.addEventListener('click', addCloud);
            elements.savePopupBtn.addEventListener('click', savePopupSettings);
            
            // Import/Export events
            elements.exportDataBtn.addEventListener('click', exportData);
            elements.importDataBtn.addEventListener('click', importData);
            
            // Dev login events
            elements.confirmDevLogin.addEventListener('click', confirmDevLogin);
            elements.cancelDevLogin.addEventListener('click', () => {
                hidePopup(elements.devLogin);
            });
            
            // Cloud viewer events
            elements.minimizeCloud.addEventListener('click', minimizeCloud);
            elements.closeCloud.addEventListener('click', closeCloud);
            
            // Close chat menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!elements.chatMenu.contains(e.target) && e.target !== elements.chatMenuBtn) {
                    elements.chatMenu.classList.remove('active');
                }
            });
        }

        // Navigation functions
        function setupNavigation() {
            // Make floating nav draggable
            makeFloatingNavDraggable();
            
            // Load saved navigation settings
            const savedNavSettings = localStorage.getItem('navigationSettings');
            if (savedNavSettings) {
                const navSettings = JSON.parse(savedNavSettings);
                appState.navigation = { ...appState.navigation, ...navSettings };
                applyNavigationSettings();
            }
        }

        function makeFloatingNavDraggable() {
            let isDragging = false;
            let offsetX, offsetY;
            
            elements.floatingNav.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            function startDrag(e) {
                if (appState.navigation.floatingNavLocked || e.target !== elements.floatingNav && !e.target.classList.contains('floating-nav-btn')) {
                    return;
                }
                
                isDragging = true;
                const rect = elements.floatingNav.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
                
                elements.floatingNav.style.transition = 'none';
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const x = e.clientX - offsetX;
                const y = e.clientY - offsetY;
                
                // Keep within viewport bounds
                const maxX = window.innerWidth - elements.floatingNav.offsetWidth;
                const maxY = window.innerHeight - elements.floatingNav.offsetHeight;
                
                elements.floatingNav.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
                elements.floatingNav.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
                elements.floatingNav.style.right = 'auto';
                elements.floatingNav.style.bottom = 'auto';
            }
            
            function stopDrag() {
                if (!isDragging) return;
                
                isDragging = false;
                elements.floatingNav.style.transition = 'all 0.3s ease';
                
                // Save position
                saveNavigationSettings();
            }
        }

        function setNavigationPosition(position) {
            appState.navigation.position = position;
            applyNavigationSettings();
            saveNavigationSettings();
        }

        function applyNavigationSettings() {
            // Reset all positions
            elements.floatingNav.style.left = 'auto';
            elements.floatingNav.style.right = 'auto';
            elements.floatingNav.style.top = 'auto';
            elements.floatingNav.style.bottom = 'auto';
            elements.floatingNav.style.transform = 'none';
            
            switch (appState.navigation.position) {
                case 'top':
                    elements.floatingNav.style.top = '20px';
                    elements.floatingNav.style.left = '50%';
                    elements.floatingNav.style.transform = 'translateX(-50%)';
                    elements.floatingNav.style.flexDirection = 'row';
                    break;
                case 'bottom':
                    elements.floatingNav.style.bottom = '20px';
                    elements.floatingNav.style.left = '50%';
                    elements.floatingNav.style.transform = 'translateX(-50%)';
                    elements.floatingNav.style.flexDirection = 'row';
                    break;
                case 'left':
                    elements.floatingNav.style.left = '20px';
                    elements.floatingNav.style.top = '50%';
                    elements.floatingNav.style.transform = 'translateY(-50%)';
                    elements.floatingNav.style.flexDirection = 'column';
                    break;
                case 'right':
                default:
                    elements.floatingNav.style.right = '20px';
                    elements.floatingNav.style.top = '50%';
                    elements.floatingNav.style.transform = 'translateY(-50%)';
                    elements.floatingNav.style.flexDirection = 'column';
                    break;
            }
            
            // Apply lock state
            if (appState.navigation.floatingNavLocked) {
                elements.navLockBtn.classList.add('locked');
                elements.navLockBtn.textContent = '🔓';
            } else {
                elements.navLockBtn.classList.remove('locked');
                elements.navLockBtn.textContent = '🔒';
            }
            
            // Apply visibility state
            if (appState.navigation.floatingNavVisible) {
                elements.floatingNav.classList.remove('minimized');
                elements.navHideBtn.textContent = '^';
            } else {
                elements.floatingNav.classList.add('minimized');
                elements.navHideBtn.textContent = 'v';
            }
        }

        function toggleFloatingNav() {
            appState.navigation.position = appState.navigation.position === 'float' ? 'right' : 'float';
            applyNavigationSettings();
            saveNavigationSettings();
        }

        function toggleFloatingNavLock() {
            appState.navigation.floatingNavLocked = !appState.navigation.floatingNavLocked;
            applyNavigationSettings();
            saveNavigationSettings();
        }

        function toggleFloatingNavVisibility() {
            appState.navigation.floatingNavVisible = !appState.navigation.floatingNavVisible;
            applyNavigationSettings();
            saveNavigationSettings();
        }

        function loadNavigationSettings() {
            const savedSettings = localStorage.getItem('navigationSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                appState.navigation = { ...appState.navigation, ...settings };
                applyNavigationSettings();
            }
        }

        function saveNavigationSettings() {
            localStorage.setItem('navigationSettings', JSON.stringify(appState.navigation));
        }

        // Registration form functions
        function showRegistrationForm() {
            elements.registrationForm.classList.add('active');
        }

        function hideRegistrationForm() {
            elements.registrationForm.classList.remove('active');
        }

        // Authentication
        function checkAuthState() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                completeLogin();
            }
        }

        async function handleLogin() {
            const username = elements.username.value.trim();
            const password = elements.password.value;
            
            if (!username || !password) {
                alert('Vui lòng nhập tên đăng nhập và mật khẩu');
                return;
            }
            
            // Simple authentication - in a real app, this would be more secure
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[username] && users[username].password === password) {
                appState.currentUser = users[username];
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                completeLogin();
            } else {
                alert('Tên đăng nhập hoặc mật khẩu không đúng');
            }
        }

        async function handleRegister() {
            const username = elements.regUsername.value.trim();
            const password = elements.regPassword.value;
            const confirmPass = elements.confirmPassword.value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            
            if (!username || !password || !confirmPass) {
                alert('Vui lòng điền đầy đủ thông tin');
                return;
            }
            
            if (password !== confirmPass) {
                alert('Mật khẩu xác nhận không khớp');
                return;
            }
            
            if (!gender) {
                alert('Vui lòng chọn giới tính');
                return;
            }
            
            try {
                // Get existing users
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                
                // Check if username already exists
                if (users[username]) {
                    alert('Tên đăng nhập đã tồn tại');
                    return;
                }
                
                // Create new user
                const newUser = {
                    username: username,
                    password: password, // In a real app, this should be hashed
                    gender: gender,
                    diamonds: 100,
                    avatar: DEFAULT_AVATAR_URL,
                    createdAt: Date.now(),
                    votes: {}
                };
                
                // Save user
                users[username] = newUser;
                localStorage.setItem('users', JSON.stringify(users));
                
                // Set as current user
                appState.currentUser = newUser;
                localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                
                // Add 50 coins for new user
                addCoins(50);
                alert('Đăng ký thành công! Bạn đã được tặng 50 xu!');
                
                console.log('Đăng ký thành công:', newUser);
                hideRegistrationForm();
                completeLogin();
            } catch (error) {
                console.error('Lỗi đăng ký:', error);
                alert('Đăng ký thất bại: ' + error.message);
            }
        }

        function handleGuestLogin() {
            appState.isGuest = true;
            appState.currentUser = {
                username: 'Khách',
                diamonds: 0,
                avatar: DEFAULT_AVATAR_URL,
                votes: {}
            };
            
            completeLogin();
        }

        function completeLogin() {
            elements.loginScreen.classList.remove('active');
            elements.mainApp.classList.add('active');
            
            updateUserDisplay();
            updateCoinsDisplay();
            loadGames();
            loadClouds();
            
            // Show welcome popup if needed
            setTimeout(() => {
                checkWelcomePopup();
            }, 500);
        }

        function showLogoutConfirm() {
            showPopup(elements.logoutConfirmPopup);
        }

        function handleLogout() {
            appState.isLoggedIn = false;
            appState.isGuest = false;
            appState.currentUser = null;
            
            localStorage.removeItem('currentUser');
            
            elements.mainApp.classList.remove('active');
            elements.loginScreen.classList.add('active');
            
            // Clear login form
            elements.username.value = '';
            elements.password.value = '';
            
            hidePopup(elements.logoutConfirmPopup);
        }

        function updateUserDisplay() {
            if (appState.currentUser) {
                elements.userDisplay.textContent = appState.currentUser.username;
                elements.accountName.textContent = appState.currentUser.username;
                elements.accountDiamonds.textContent = appState.currentUser.diamonds + ' Kim cương';
                
                // Set avatar - sử dụng avatar mặc định nếu không có
                elements.accountAvatar.src = appState.currentUser.avatar || DEFAULT_AVATAR_URL;
            }
        }

        // Coins management
        function updateCoinsDisplay() {
            elements.coinsDisplay.textContent = `💰 ${appState.coins}`;
        }

        function addCoins(amount) {
            appState.coins += amount;
            localStorage.setItem('coins', appState.coins);
            updateCoinsDisplay();
        }

        function spendCoins(amount) {
            if (appState.coins >= amount) {
                appState.coins -= amount;
                localStorage.setItem('coins', appState.coins);
                updateCoinsDisplay();
                return true;
            }
            return false;
        }

        // Daily login system
        function setupDailyLogin() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            // Create day items
            elements.dailyCalendar.innerHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const dayItem = document.createElement('div');
                dayItem.className = 'day-item';
                
                // Check if this day is today
                if (i === dayOfWeek) {
                    dayItem.classList.add('active');
                    
                    // Check if already claimed today
                    const lastClaimed = appState.dailyLogin.lastClaimed;
                    if (lastClaimed) {
                        const lastClaimedDate = new Date(lastClaimed);
                        if (lastClaimedDate.toDateString() === today.toDateString()) {
                            dayItem.classList.add('claimed');
                        }
                    }
                }
                
                dayItem.innerHTML = `
                    <div class="day-name">${getDayName(i)}</div>
                    <div class="day-coins">${DAILY_REWARDS[i]} xu</div>
                `;
                
                // Add click event to claim reward
                if (i === dayOfWeek) {
                    dayItem.addEventListener('click', claimDailyReward);
                }
                
                elements.dailyCalendar.appendChild(dayItem);
            }
        }

        function getDayName(dayIndex) {
            const days = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];
            return days[dayIndex];
        }

        function claimDailyReward() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            
            // Check if already claimed today
            const lastClaimed = appState.dailyLogin.lastClaimed;
            if (lastClaimed) {
                const lastClaimedDate = new Date(lastClaimed);
                if (lastClaimedDate.toDateString() === today.toDateString()) {
                    alert('Bạn đã nhận thưởng hôm nay rồi!');
                    return;
                }
                
                // Check if consecutive day
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                if (lastClaimedDate.toDateString() === yesterday.toDateString()) {
                    appState.dailyLogin.streak++;
                } else {
                    appState.dailyLogin.streak = 1;
                }
            } else {
                appState.dailyLogin.streak = 1;
            }
            
            // Update last claimed
            appState.dailyLogin.lastClaimed = today.toISOString();
            localStorage.setItem('dailyLogin', JSON.stringify(appState.dailyLogin));
            
            // Add coins
            const reward = DAILY_REWARDS[dayOfWeek];
            addCoins(reward);
            
            // Update UI
            setupDailyLogin();
            
            alert(`Bạn đã nhận ${reward} xu! Chuỗi đăng nhập: ${appState.dailyLogin.streak} ngày`);
        }

        function claimCode() {
            const code = elements.codeInput.value.trim();
            
            if (!code) {
                alert('Vui lòng nhập mã code');
                return;
            }
            
            if (code === 'Tuann') {
                addCoins(99999);
                alert('Bạn đã nhận 99999 xu!');
                elements.codeInput.value = '';
            } else {
                alert('Mã code không hợp lệ');
            }
        }

        // Avatar upload function
        async function handleAvatarUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!appState.currentUser || appState.isGuest) {
                alert('Vui lòng đăng nhập để thay đổi avatar');
                return;
            }
            
            try {
                // Convert image to base64 for localStorage
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    
                    // Update user data
                    appState.currentUser.avatar = imageData;
                    
                    // Update localStorage
                    if (!appState.isGuest) {
                        const users = JSON.parse(localStorage.getItem('users') || '{}');
                        users[appState.currentUser.username].avatar = imageData;
                        localStorage.setItem('users', JSON.stringify(users));
                        localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                    }
                    
                    // Update UI
                    elements.accountAvatar.src = imageData;
                    
                    alert('Avatar đã được cập nhật thành công!');
                };
                
                reader.readAsDataURL(file);
            } catch (error) {
                console.error('Lỗi upload avatar:', error);
                alert('Lỗi upload avatar: ' + error.message);
            }
        }

        // Name edit functions
        function showNameEditPopup() {
            elements.newNameInput.value = appState.currentUser.username || '';
            showPopup(elements.nameEditPopup);
        }

        function hideNameEditPopup() {
            hidePopup(elements.nameEditPopup);
        }

        async function saveName() {
            const newName = elements.newNameInput.value.trim();
            
            if (!newName) {
                alert('Vui lòng nhập tên mới');
                return;
            }
            
            if (!appState.currentUser || appState.isGuest) {
                alert('Vui lòng đăng nhập để thay đổi tên');
                return;
            }
            
            try {
                // Update user data
                appState.currentUser.username = newName;
                
                // Update localStorage
                if (!appState.isGuest) {
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    // Remove old user entry and create new one
                    delete users[appState.currentUser.oldUsername];
                    users[newName] = appState.currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                }
                
                // Update UI
                updateUserDisplay();
                
                hideNameEditPopup();
                alert('Tên đã được cập nhật thành công!');
            } catch (error) {
                console.error('Lỗi cập nhật tên:', error);
                alert('Lỗi cập nhật tên: ' + error.message);
            }
        }

        // Music functions
        function toggleMusicPlayer() {
            elements.musicPlayer.classList.toggle('active');
        }

        function hideMusicPlayer() {
            elements.musicPlayer.classList.remove('active');
        }

        function playMusicFromUrl() {
            const url = elements.musicUrlInput.value.trim();
            if (!url) {
                alert('Vui lòng nhập URL nhạc');
                return;
            }
            
            // Check if URL is valid
            try {
                new URL(url);
            } catch (e) {
                alert('URL không hợp lệ');
                return;
            }
            
            elements.backgroundMusic.src = url;
            elements.backgroundMusic.play();
            appState.music.isPlaying = true;
            appState.music.currentTrack = 'custom';
            
            // Update active button
            document.querySelectorAll('.music-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function playMusic(track) {
            if (MUSIC_TRACKS[track]) {
                elements.backgroundMusic.src = MUSIC_TRACKS[track];
                elements.backgroundMusic.play();
                appState.music.isPlaying = true;
                appState.music.currentTrack = track;
                
                // Update active button
                document.querySelectorAll('.music-buttons button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(track).classList.add('active');
            }
        }

        function searchMusic() {
            const query = elements.musicUrlInput.value.trim();
            if (!query) {
                alert('Vui lòng nhập từ khóa tìm kiếm');
                return;
            }
            
            // In a real app, you would integrate with a music API here
            alert(`Tìm kiếm nhạc với từ khóa: ${query}\n\nTính năng này cần tích hợp với API nhạc.`);
        }

        function stopMusic() {
            elements.backgroundMusic.pause();
            elements.backgroundMusic.currentTime = 0;
            appState.music.isPlaying = false;
            appState.music.currentTrack = null;
            
            // Remove active class from all buttons
            document.querySelectorAll('.music-buttons button').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Chat functions with Gemini API
        function toggleChat() {
            elements.chatContainer.classList.toggle('active');
            appState.chat.isOpen = !appState.chat.isOpen;
        }

        function toggleChatMenu() {
            elements.chatMenu.classList.toggle('active');
        }

        function loadChatHistory() {
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                appState.chat.history = JSON.parse(savedHistory);
                
                // Load current chat if exists
                if (appState.chat.history[appState.chat.currentChat]) {
                    renderChatHistory(appState.chat.history[appState.chat.currentChat]);
                }
            }
        }

        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(appState.chat.history));
        }

        function renderChatHistory(messages) {
            elements.chatContent.innerHTML = '';
            
            if (messages && messages.length > 0) {
                messages.forEach(msg => {
                    addMessageToChat(msg.text, msg.sender);
                });
            }
        }

        function addMessageToChat(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = text;
            
            elements.chatContent.appendChild(messageDiv);
            elements.chatContent.scrollTop = elements.chatContent.scrollHeight;
        }

        async function sendMessage() {
            const message = elements.chatInput.value.trim();
            
            if (!message || appState.chat.isBotTyping) return;
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            
            // Save to history
            if (!appState.chat.history[appState.chat.currentChat]) {
                appState.chat.history[appState.chat.currentChat] = [];
            }
            
            appState.chat.history[appState.chat.currentChat].push({
                text: message,
                sender: 'user',
                timestamp: Date.now()
            });
            
            saveChatHistory();
            
            // Clear input
            elements.chatInput.value = '';
            
            // Disable send button while bot is typing
            elements.sendMessageBtn.disabled = true;
            appState.chat.isBotTyping = true;
            
            try {
                // Call Gemini API
                const botResponse = await callGeminiAPI(message);
                
                // Add bot message to chat
                addMessageToChat(botResponse, 'bot');
                
                // Save to history
                appState.chat.history[appState.chat.currentChat].push({
                    text: botResponse,
                    sender: 'bot',
                    timestamp: Date.now()
                });
                
                saveChatHistory();
            } catch (error) {
                console.error('Lỗi khi gọi API Gemini:', error);
                addMessageToChat('Xin lỗi, tôi đang gặp sự cố kỹ thuật. Vui lòng thử lại sau.', 'bot');
            } finally {
                // Re-enable send button
                elements.sendMessageBtn.disabled = false;
                appState.chat.isBotTyping = false;
            }
        }

        async function callGeminiAPI(userMessage) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: userMessage
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error('Invalid response from Gemini API');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                throw error;
            }
        }

        function createNewChat() {
            const chatId = 'chat_' + Date.now();
            appState.chat.currentChat = chatId;
            appState.chat.history[chatId] = [];
            elements.chatContent.innerHTML = '';
            elements.chatMenu.classList.remove('active');
        }

        function renameChat() {
            const newName = prompt('Nhập tên mới cho đoạn chat:');
            if (newName) {
                elements.chatTitle.textContent = newName;
            }
            elements.chatMenu.classList.remove('active');
        }

        function pinChat() {
            // In a real app, you would implement pinning functionality
            alert('Đã ghim đoạn chat');
            elements.chatMenu.classList.remove('active');
        }

        function deleteChat() {
            if (confirm('Bạn có chắc muốn xoá đoạn chat này?')) {
                delete appState.chat.history[appState.chat.currentChat];
                createNewChat();
                saveChatHistory();
            }
            elements.chatMenu.classList.remove('active');
        }

        // Navigation
        function switchPage(page) {
            // Update active nav button
            elements.navBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.page === page);
            });
            
            // Update active page
            elements.downloadPage.classList.toggle('active', page === 'download');
            elements.cloudPage.classList.toggle('active', page === 'cloud');
            elements.settingsPage.classList.toggle('active', page === 'settings');
            
            appState.currentPage = page;
        }

        // Theme management
        function toggleTheme() {
            const newTheme = elements.themeSwitch.checked ? 'dark' : 'light';
            applyTheme(newTheme);
            
            // Save theme to localStorage
            localStorage.setItem('theme', newTheme);
        }

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            elements.themeSwitch.checked = theme === 'dark';
        }

        // Welcome popup
        function checkWelcomePopup() {
            if (!appState.welcomePopup.show) return;
            
            const now = Date.now();
            if (appState.welcomePopup.disabledUntil && now < appState.welcomePopup.disabledUntil) {
                return;
            }
            
            showPopup(elements.welcomePopup);
        }

        function hideWelcomePopup() {
            if (elements.disableNotification.checked) {
                const twoHours = 2 * 60 * 60 * 1000; // 2 hours in milliseconds
                appState.welcomePopup.disabledUntil = Date.now() + twoHours;
            }
            
            hidePopup(elements.welcomePopup);
            appState.welcomePopup.show = false;
        }

        // Games management
        async function loadGames() {
            try {
                // Try to load from localStorage first
                let gamesData = JSON.parse(localStorage.getItem('games') || '[]');
                
                // If no games in localStorage, try to load from download.json
                if (gamesData.length === 0) {
                    try {
                        const response = await fetch('download.json');
                        if (response.ok) {
                            gamesData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('games', JSON.stringify(gamesData));
                        }
                    } catch (error) {
                        console.error('Lỗi tải download.json:', error);
                    }
                }
                
                renderGames(gamesData);
            } catch (error) {
                console.error('Lỗi tải games:', error);
                renderGames([]);
            }
        }

        function renderGames(games) {
            elements.gamesGrid.innerHTML = '';
            
            if (games.length === 0) {
                elements.gamesGrid.innerHTML = `
                    <div class="empty-state">
                        <p>Chưa có game nào</p>
                    </div>
                `;
                return;
            }
            
            games.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card';
                gameCard.innerHTML = `
                    <img src="${game.image}" alt="${game.name}">
                    <div class="game-info">
                        <h3>${game.name}</h3>
                    </div>
                `;
                
                gameCard.addEventListener('click', () => {
                    showGameDetail(game);
                });
                
                elements.gamesGrid.appendChild(gameCard);
            });
        }

        function showGameDetail(game) {
            elements.gameDetailImage.src = game.image;
            elements.gameDetailTitle.textContent = game.name;
            elements.downloadGameBtn.dataset.url = game.downloadUrl;
            
            showPopup(elements.gameDetailPopup);
        }

        function downloadCurrentGame() {
            const url = elements.downloadGameBtn.dataset.url;
            window.open(url, '_blank');
            hidePopup(elements.gameDetailPopup);
        }

        // Cloud management
        async function loadClouds() {
            try {
                // Try to load from localStorage first
                let cloudsData = JSON.parse(localStorage.getItem('clouds') || '[]');
                
                // If no clouds in localStorage, try to load from cloud.json
                if (cloudsData.length === 0) {
                    try {
                        const response = await fetch('cloud.json');
                        if (response.ok) {
                            cloudsData = await response.json();
                            // Save to localStorage for future use
                            localStorage.setItem('clouds', JSON.stringify(cloudsData));
                        }
                    } catch (error) {
                        console.error('Lỗi tải cloud.json:', error);
                    }
                }
                
                renderClouds(cloudsData);
            } catch (error) {
                console.error('Lỗi tải clouds:', error);
                renderClouds([]);
            }
        }

        function renderClouds(clouds) {
            elements.cloudsGrid.innerHTML = '';
            
            if (clouds.length === 0) {
                elements.cloudsGrid.innerHTML = `
                    <div class="empty-state">
                        <p>Chưa có cloud nào</p>
                    </div>
                `;
                return;
            }
            
            clouds.forEach(cloud => {
                const cloudCard = document.createElement('div');
                cloudCard.className = 'cloud-card';
                
                // Kiểm tra trạng thái vote của người dùng
                const userVote = getUserVoteForCloud(cloud.id);
                const isLiked = userVote === 'like';
                const isDisliked = userVote === 'dislike';
                const canVote = canUserVote(cloud.id);
                
                cloudCard.innerHTML = `
                    <img src="${cloud.image}" alt="${cloud.name}">
                    <div class="cloud-info">
                        <h3>${cloud.name}</h3>
                        <div class="cloud-stats">
                            <button class="like-btn ${isLiked ? 'active' : ''} ${!canVote ? 'disabled' : ''}" 
                                    data-id="${cloud.id}" 
                                    ${!canVote ? 'disabled' : ''}>
                                👍 ${cloud.likes || 0}
                            </button>
                            <button class="dislike-btn ${isDisliked ? 'active' : ''} ${!canVote ? 'disabled' : ''}" 
                                    data-id="${cloud.id}" 
                                    ${!canVote ? 'disabled' : ''}>
                                👎 ${cloud.dislikes || 0}
                            </button>
                        </div>
                        ${!canVote ? '<div class="vote-cooldown">Có thể vote lại sau 10 phút</div>' : ''}
                    </div>
                `;
                
                // Open cloud viewer on click
                cloudCard.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('like-btn') && !e.target.classList.contains('dislike-btn') && !e.target.classList.contains('vote-cooldown')) {
                        openCloudPurchase(cloud);
                    }
                });
                
                // Like/dislike buttons
                const likeBtn = cloudCard.querySelector('.like-btn');
                const dislikeBtn = cloudCard.querySelector('.dislike-btn');
                
                likeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (canVote) {
                        likeCloud(cloud.id);
                    }
                });
                
                dislikeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (canVote) {
                        dislikeCloud(cloud.id);
                    }
                });
                
                elements.cloudsGrid.appendChild(cloudCard);
            });
        }

        // Cloud purchase functions
        function openCloudPurchase(cloud) {
            // Check if user already has active purchase for this cloud
            const cloudPurchase = appState.purchasedClouds[cloud.id];
            if (cloudPurchase) {
                const now = Date.now();
                if (cloudPurchase.expiresAt === 'infinite' || now < cloudPurchase.expiresAt) {
                    // User has active purchase, open cloud directly
                    openCloud(cloud.name, cloud.url, cloud.id);
                    return;
                } else {
                    // Purchase expired, remove it
                    delete appState.purchasedClouds[cloud.id];
                    localStorage.setItem('purchasedClouds', JSON.stringify(appState.purchasedClouds));
                }
            }
            
            // Show purchase options
            elements.cloudPurchaseTitle.textContent = `Mua Cloud: ${cloud.name}`;
            elements.confirmPurchaseBtn.dataset.cloudId = cloud.id;
            elements.confirmPurchaseBtn.dataset.cloudName = cloud.name;
            elements.confirmPurchaseBtn.dataset.cloudUrl = cloud.url;
            
            // Reset purchase options selection
            document.querySelectorAll('.purchase-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            showPopup(elements.cloudPurchasePopup);
            
            // Add click events to purchase options
            document.querySelectorAll('.purchase-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.purchase-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
        }

        function confirmCloudPurchase() {
            const selectedOption = document.querySelector('.purchase-option.selected');
            if (!selectedOption) {
                alert('Vui lòng chọn gói thời gian sử dụng');
                return;
            }
            
            const cloudId = elements.confirmPurchaseBtn.dataset.cloudId;
            const cloudName = elements.confirmPurchaseBtn.dataset.cloudName;
            const cloudUrl = elements.confirmPurchaseBtn.dataset.cloudUrl;
            const duration = selectedOption.dataset.duration;
            const price = parseInt(selectedOption.dataset.price);
            
            if (!spendCoins(price)) {
                alert('Bạn không đủ xu để mua gói này');
                return;
            }
            
            // Calculate expiration time
            let expiresAt;
            if (duration === 'infinite') {
                expiresAt = 'infinite';
            } else {
                const hours = parseInt(duration);
                expiresAt = Date.now() + (hours * 60 * 60 * 1000);
            }
            
            // Save purchase
            appState.purchasedClouds[cloudId] = {
                purchasedAt: Date.now(),
                expiresAt: expiresAt,
                duration: duration
            };
            localStorage.setItem('purchasedClouds', JSON.stringify(appState.purchasedClouds));
            
            // Open cloud
            openCloud(cloudName, cloudUrl, cloudId);
            
            hidePopup(elements.cloudPurchasePopup);
            alert(`Bạn đã mua cloud ${cloudName} thành công!`);
        }

        // Vote management functions
        function getUserVoteForCloud(cloudId) {
            if (!appState.currentUser || !appState.currentUser.votes) {
                return null;
            }
            return appState.currentUser.votes[cloudId];
        }

        function canUserVote(cloudId) {
            if (!appState.currentUser || !appState.currentUser.votes) {
                return true;
            }
            
            const voteData = appState.currentUser.votes[cloudId];
            if (!voteData) {
                return true;
            }
            
            const now = Date.now();
            const lastVoteTime = voteData.timestamp;
            return (now - lastVoteTime) > VOTE_COOLDOWN;
        }

        async function likeCloud(cloudId) {
            if (!canUserVote(cloudId)) {
                alert('Bạn phải chờ 10 phút sau mới có thể vote lại!');
                return;
            }
            
            try {
                const clouds = JSON.parse(localStorage.getItem('clouds') || '[]');
                const cloudIndex = clouds.findIndex(c => c.id === cloudId);
                
                if (cloudIndex !== -1) {
                    const cloud = clouds[cloudIndex];
                    const userVote = getUserVoteForCloud(cloudId);
                    let newLikes = cloud.likes || 0;
                    let newDislikes = cloud.dislikes || 0;
                    
                    // Nếu đã dislike trước đó, bỏ dislike
                    if (userVote === 'dislike') {
                        newDislikes = Math.max(0, newDislikes - 1);
                    }
                    
                    // Nếu chưa like thì tăng like, nếu đã like thì bỏ like
                    if (userVote === 'like') {
                        newLikes = Math.max(0, newLikes - 1);
                    } else {
                        newLikes += 1;
                    }
                    
                    clouds[cloudIndex].likes = newLikes;
                    clouds[cloudIndex].dislikes = newDislikes;
                    
                    localStorage.setItem('clouds', JSON.stringify(clouds));
                    
                    // Update user vote data
                    await updateUserVote(cloudId, userVote === 'like' ? null : 'like');
                    
                    loadClouds(); // Refresh the view
                }
            } catch (error) {
                console.error('Lỗi like cloud:', error);
                alert('Lỗi khi like: ' + error.message);
            }
        }

        async function dislikeCloud(cloudId) {
            if (!canUserVote(cloudId)) {
                alert('Bạn phải chờ 10 phút sau mới có thể vote lại!');
                return;
            }
            
            try {
                const clouds = JSON.parse(localStorage.getItem('clouds') || '[]');
                const cloudIndex = clouds.findIndex(c => c.id === cloudId);
                
                if (cloudIndex !== -1) {
                    const cloud = clouds[cloudIndex];
                    const userVote = getUserVoteForCloud(cloudId);
                    let newLikes = cloud.likes || 0;
                    let newDislikes = cloud.dislikes || 0;
                    
                    // Nếu đã like trước đó, bỏ like
                    if (userVote === 'like') {
                        newLikes = Math.max(0, newLikes - 1);
                    }
                    
                    // Nếu chưa dislike thì tăng dislike, nếu đã dislike thì bỏ dislike
                    if (userVote === 'dislike') {
                        newDislikes = Math.max(0, newDislikes - 1);
                    } else {
                        newDislikes += 1;
                    }
                    
                    clouds[cloudIndex].likes = newLikes;
                    clouds[cloudIndex].dislikes = newDislikes;
                    
                    localStorage.setItem('clouds', JSON.stringify(clouds));
                    
                    // Update user vote data
                    await updateUserVote(cloudId, userVote === 'dislike' ? null : 'dislike');
                    
                    loadClouds(); // Refresh the view
                }
            } catch (error) {
                console.error('Lỗi dislike cloud:', error);
                alert('Lỗi khi dislike: ' + error.message);
            }
        }

        async function updateUserVote(cloudId, voteType) {
            if (!appState.currentUser || appState.isGuest) {
                return;
            }
            
            try {
                if (voteType === null) {
                    // Remove vote
                    delete appState.currentUser.votes[cloudId];
                } else {
                    // Add/update vote
                    appState.currentUser.votes[cloudId] = {
                        type: voteType,
                        timestamp: Date.now()
                    };
                }
                
                // Update localStorage
                if (!appState.isGuest) {
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    users[appState.currentUser.username].votes = appState.currentUser.votes;
                    localStorage.setItem('users', JSON.stringify(users));
                    localStorage.setItem('currentUser', JSON.stringify(appState.currentUser));
                }
            } catch (error) {
                console.error('Lỗi cập nhật vote:', error);
            }
        }

        // Cloud Viewer
        function openCloud(name, url, cloudId) {
            // Check if user has active purchase for this cloud
            const cloudPurchase = appState.purchasedClouds[cloudId];
            if (!cloudPurchase) {
                alert('Bạn chưa mua cloud này!');
                return;
            }
            
            const now = Date.now();
            if (cloudPurchase.expiresAt !== 'infinite' && now >= cloudPurchase.expiresAt) {
                alert('Thời gian sử dụng cloud của bạn đã hết! Vui lòng mua lại.');
                delete appState.purchasedClouds[cloudId];
                localStorage.setItem('purchasedClouds', JSON.stringify(appState.purchasedClouds));
                return;
            }
            
            elements.cloudViewerTitle.textContent = name;
            elements.cloudFrame.src = url;
            
            appState.cloudViewer.isOpen = true;
            appState.cloudViewer.currentCloud = { name, url, id: cloudId };
            appState.cloudViewer.isMinimized = false;
            
            // Calculate remaining time
            if (cloudPurchase.expiresAt === 'infinite') {
                appState.cloudViewer.remainingTime = 'infinite';
                elements.cloudTime.textContent = 'Vô hạn';
            } else {
                appState.cloudViewer.remainingTime = cloudPurchase.expiresAt - now;
                updateCloudTimeDisplay();
                
                // Start countdown timer
                if (appState.cloudViewer.timer) {
                    clearInterval(appState.cloudViewer.timer);
                }
                
                appState.cloudViewer.timer = setInterval(() => {
                    appState.cloudViewer.remainingTime -= 1000;
                    updateCloudTimeDisplay();
                    
                    if (appState.cloudViewer.remainingTime <= 0) {
                        clearInterval(appState.cloudViewer.timer);
                        closeCloud();
                        alert('Thời gian sử dụng cloud của bạn đã hết!');
                    }
                }, 1000);
            }
            
            elements.cloudViewer.classList.add('active');
            elements.cloudViewer.classList.remove('minimized');
        }

        function updateCloudTimeDisplay() {
            if (appState.cloudViewer.remainingTime === 'infinite') {
                elements.cloudTime.textContent = 'Vô hạn';
                return;
            }
            
            const hours = Math.floor(appState.cloudViewer.remainingTime / (1000 * 60 * 60));
            const minutes = Math.floor((appState.cloudViewer.remainingTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((appState.cloudViewer.remainingTime % (1000 * 60)) / 1000);
            
            elements.cloudTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function minimizeCloud() {
            appState.cloudViewer.isMinimized = true;
            elements.cloudViewer.classList.add('minimized');
            
            setTimeout(() => {
                if (appState.cloudViewer.isMinimized) {
                    elements.cloudViewer.classList.remove('active');
                }
            }, 250);
        }

        function closeCloud() {
            appState.cloudViewer.isOpen = false;
            appState.cloudViewer.currentCloud = null;
            appState.cloudViewer.isMinimized = false;
            
            if (appState.cloudViewer.timer) {
                clearInterval(appState.cloudViewer.timer);
                appState.cloudViewer.timer = null;
            }
            
            elements.cloudViewer.classList.remove('active');
            elements.cloudFrame.src = '';
        }

        function checkActiveCloudSessions() {
            // Check if any purchased clouds are still valid
            const now = Date.now();
            let hasActiveSession = false;
            
            for (const cloudId in appState.purchasedClouds) {
                const purchase = appState.purchasedClouds[cloudId];
                if (purchase.expiresAt === 'infinite' || now < purchase.expiresAt) {
                    hasActiveSession = true;
                    break;
                }
            }
            
            if (hasActiveSession) {
                // In a real app, you would restore the cloud session here
                console.log('Found active cloud sessions');
            }
        }

        function restoreCloud() {
            if (appState.cloudViewer.currentCloud) {
                openCloud(
                    appState.cloudViewer.currentCloud.name,
                    appState.cloudViewer.currentCloud.url,
                    appState.cloudViewer.currentCloud.id
                );
            }
        }

        // Developer Mode
        function openDevLogin() {
            showPopup(elements.devLogin);
        }

        function confirmDevLogin() {
            const password = elements.devPassword.value;
            
            if (password === '09090909') {
                appState.devMode = true;
                hidePopup(elements.devLogin);
                showPopup(elements.devMode);
                
                // Load dev data
                loadDevData();
            } else {
                alert('Mật khẩu không đúng');
            }
        }

        function switchDevTab(tabName) {
            // Update active tab
            elements.devTabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Update active content
            elements.devTabContents.forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}Tab`);
            });
        }

        async function loadDevData() {
            // Load videos
            await loadVideosList();
            
            // Load games
            await loadGamesList();
            
            // Load clouds
            await loadCloudsList();
            
            // Load popup settings
            await loadPopupSettings();
        }

        // Dev - Videos management
        async function loadVideosList() {
            try {
                const videosData = JSON.parse(localStorage.getItem('videos') || '[]');
                renderVideosList(videosData);
            } catch (error) {
                console.error('Lỗi tải videos:', error);
            }
        }

        function renderVideosList(videos) {
            elements.videosList.innerHTML = '';
            
            videos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'item';
                videoItem.innerHTML = `
                    <div class="item-info">
                        <h4>${video.title || 'Video'}</h4>
                        <p>${video.url}</p>
                    </div>
                    <div class="item-actions">
                        <button class="delete-btn" data-id="${video.id}">Xóa</button>
                    </div>
                `;
                
                videoItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-btn')) {
                        videoItem.classList.toggle('selected');
                    }
                });
                
                const deleteBtn = videoItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteVideo(video.id);
                });
                
                elements.videosList.appendChild(videoItem);
            });
        }

        async function addVideo() {
            const url = elements.videoUrl.value.trim();
            
            if (!url) {
                alert('Vui lòng nhập link YouTube');
                return;
            }
            
            try {
                const newVideo = {
                    id: Date.now(),
                    url,
                    title: `Video ${Date.now()}`
                };
                
                const videos = JSON.parse(localStorage.getItem('videos') || '[]');
                videos.push(newVideo);
                localStorage.setItem('videos', JSON.stringify(videos));
                
                renderVideosList(videos);
                
                elements.videoUrl.value = '';
            } catch (error) {
                console.error('Lỗi thêm video:', error);
                alert('Lỗi thêm video: ' + error.message);
            }
        }

        async function getVideos() {
            return JSON.parse(localStorage.getItem('videos') || '[]');
        }

        async function deleteVideo(videoId) {
            try {
                const videos = JSON.parse(localStorage.getItem('videos') || '[]');
                const filteredVideos = videos.filter(v => v.id !== videoId);
                localStorage.setItem('videos', JSON.stringify(filteredVideos));
                renderVideosList(filteredVideos);
            } catch (error) {
                console.error('Lỗi xóa video:', error);
                alert('Lỗi xóa video: ' + error.message);
            }
        }

        // Dev - Games management
        async function loadGamesList() {
            try {
                const gamesData = JSON.parse(localStorage.getItem('games') || '[]');
                renderGamesList(gamesData);
            } catch (error) {
                console.error('Lỗi tải games:', error);
            }
        }

        function renderGamesList(games) {
            elements.gamesList.innerHTML = '';
            
            games.forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.className = 'item';
                gameItem.innerHTML = `
                    <img src="${game.image}" alt="${game.name}">
                    <div class="item-info">
                        <h4>${game.name}</h4>
                        <p>${game.downloadUrl}</p>
                    </div>
                    <div class="item-actions">
                        <button class="delete-btn" data-id="${game.id}">Xóa</button>
                    </div>
                `;
                
                gameItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-btn')) {
                        gameItem.classList.toggle('selected');
                    }
                });
                
                const deleteBtn = gameItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteGame(game.id);
                });
                
                elements.gamesList.appendChild(gameItem);
            });
        }

        async function addGame() {
            const name = elements.gameName.value.trim();
            const link = elements.gameLink.value.trim();
            const imageFile = elements.gameImage.files[0];
            
            if (!name || !link) {
                alert('Vui lòng nhập tên game và link download');
                return;
            }
            
            try {
                let imageSrc = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"%3E%3Crect width="300" height="200" fill="%23006AFF"/%3E%3Ctext x="150" y="100" text-anchor="middle" fill="white" font-size="24"%3E' + encodeURIComponent(name) + '%3C/text%3E%3C/svg%3E';
                
                if (imageFile) {
                    // Convert image to base64 for localStorage
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageSrc = e.target.result;
                        completeAddGame(name, link, imageSrc);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    completeAddGame(name, link, imageSrc);
                }
            } catch (error) {
                console.error('Lỗi thêm game:', error);
                alert('Lỗi thêm game: ' + error.message);
            }
        }

        function completeAddGame(name, link, imageSrc) {
            const newGame = {
                id: Date.now(),
                name,
                downloadUrl: link,
                image: imageSrc
            };
            
            const games = JSON.parse(localStorage.getItem('games') || '[]');
            games.push(newGame);
            localStorage.setItem('games', JSON.stringify(games));
            
            renderGamesList(games);
            renderGames(games); // Update main games view
            
            // Clear form
            elements.gameName.value = '';
            elements.gameLink.value = '';
            elements.gameImage.value = '';
        }

        async function getGames() {
            return JSON.parse(localStorage.getItem('games') || '[]');
        }

        async function deleteGame(gameId) {
            try {
                const games = JSON.parse(localStorage.getItem('games') || '[]');
                const filteredGames = games.filter(g => g.id !== gameId);
                localStorage.setItem('games', JSON.stringify(filteredGames));
                renderGamesList(filteredGames);
                renderGames(filteredGames); // Update main games view
            } catch (error) {
                console.error('Lỗi xóa game:', error);
                alert('Lỗi xóa game: ' + error.message);
            }
        }

        // Dev - Clouds management
        async function loadCloudsList() {
            try {
                const cloudsData = JSON.parse(localStorage.getItem('clouds') || '[]');
                renderCloudsList(cloudsData);
            } catch (error) {
                console.error('Lỗi tải clouds:', error);
            }
        }

        function renderCloudsList(clouds) {
            elements.cloudsList.innerHTML = '';
            
            clouds.forEach(cloud => {
                const cloudItem = document.createElement('div');
                cloudItem.className = 'item';
                cloudItem.innerHTML = `
                    <img src="${cloud.image}" alt="${cloud.name}">
                    <div class="item-info">
                        <h4>${cloud.name}</h4>
                        <p>${cloud.url}</p>
                        <div class="cloud-stats-small">
                            <span>👍 ${cloud.likes || 0}</span>
                            <span>👎 ${cloud.dislikes || 0}</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="delete-btn" data-id="${cloud.id}">Xóa</button>
                    </div>
                `;
                
                cloudItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-btn')) {
                        cloudItem.classList.toggle('selected');
                    }
                });
                
                const deleteBtn = cloudItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteCloud(cloud.id);
                });
                
                elements.cloudsList.appendChild(cloudItem);
            });
        }

        async function addCloud() {
            const name = elements.cloudName.value.trim();
            const link = elements.cloudLink.value.trim();
            const imageFile = elements.cloudImage.files[0];
            
            if (!name || !link) {
                alert('Vui lòng nhập tên cloud và link');
                return;
            }
            
            try {
                let imageSrc = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200" viewBox="0 0 300 200"%3E%3Crect width="300" height="200" fill="%23006AFF"/%3E%3Ctext x="150" y="100" text-anchor="middle" fill="white" font-size="24"%3E' + encodeURIComponent(name) + '%3C/text%3E%3C/svg%3E';
                
                if (imageFile) {
                    // Convert image to base64 for localStorage
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        imageSrc = e.target.result;
                        completeAddCloud(name, link, imageSrc);
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    completeAddCloud(name, link, imageSrc);
                }
            } catch (error) {
                console.error('Lỗi thêm cloud:', error);
                alert('Lỗi thêm cloud: ' + error.message);
            }
        }

        function completeAddCloud(name, link, imageSrc) {
            const newCloud = {
                id: Date.now(),
                name,
                url: link,
                image: imageSrc,
                likes: 0,
                dislikes: 0
            };
            
            const clouds = JSON.parse(localStorage.getItem('clouds') || '[]');
            clouds.push(newCloud);
            localStorage.setItem('clouds', JSON.stringify(clouds));
            
            renderCloudsList(clouds);
            renderClouds(clouds); // Update main clouds view
            
            // Clear form
            elements.cloudName.value = '';
            elements.cloudLink.value = '';
            elements.cloudImage.value = '';
        }

        async function getClouds() {
            return JSON.parse(localStorage.getItem('clouds') || '[]');
        }

        async function deleteCloud(cloudId) {
            try {
                const clouds = JSON.parse(localStorage.getItem('clouds') || '[]');
                const filteredClouds = clouds.filter(c => c.id !== cloudId);
                localStorage.setItem('clouds', JSON.stringify(filteredClouds));
                renderCloudsList(filteredClouds);
                renderClouds(filteredClouds); // Update main clouds view
            } catch (error) {
                console.error('Lỗi xóa cloud:', error);
                alert('Lỗi xóa cloud: ' + error.message);
            }
        }

        // Dev - Popup settings
        async function loadPopupSettings() {
            try {
                const popupSettings = JSON.parse(localStorage.getItem('popupSettings') || '{}');
                
                if (popupSettings) {
                    elements.popupLink.value = popupSettings.redirectUrl || '';
                    elements.groupLink.value = popupSettings.groupUrl || '';
                }
            } catch (error) {
                console.error('Lỗi tải popup settings:', error);
            }
        }

        async function savePopupSettings() {
            const avatarFile = elements.popupAvatarInput.files[0];
            const redirectUrl = elements.popupLink.value.trim();
            const groupUrl = elements.groupLink.value.trim();
            
            try {
                let avatarUrl = '';
                
                if (avatarFile) {
                    // Convert image to base64 for localStorage
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        avatarUrl = e.target.result;
                        completeSavePopupSettings(redirectUrl, groupUrl, avatarUrl);
                    };
                    reader.readAsDataURL(avatarFile);
                } else {
                    completeSavePopupSettings(redirectUrl, groupUrl, avatarUrl);
                }
            } catch (error) {
                console.error('Lỗi lưu popup settings:', error);
                alert('Lỗi lưu cài đặt popup: ' + error.message);
            }
        }

        function completeSavePopupSettings(redirectUrl, groupUrl, avatarUrl) {
            const popupSettings = {
                redirectUrl: redirectUrl,
                groupUrl: groupUrl
            };
            
            if (avatarUrl) {
                popupSettings.avatar = avatarUrl;
            }
            
            localStorage.setItem('popupSettings', JSON.stringify(popupSettings));
            alert('Cài đặt popup đã được lưu');
        }

        // Import/Export
        async function exportData() {
            try {
                const [games, clouds, videos, settings] = await Promise.all([
                    getGames(),
                    getClouds(),
                    getVideos(),
                    Promise.resolve(JSON.parse(localStorage.getItem('popupSettings') || '{}'))
                ]);
                
                const data = {
                    games,
                    clouds,
                    videos,
                    settings
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'game-center-data.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Lỗi export data:', error);
                alert('Lỗi export data: ' + error.message);
            }
        }

        async function importData() {
            const file = elements.importDataInput.files[0];
            
            if (!file) {
                alert('Vui lòng chọn file JSON để import');
                return;
            }
            
            try {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Import data to localStorage
                        if (importedData.games) {
                            localStorage.setItem('games', JSON.stringify(importedData.games));
                        }
                        
                        if (importedData.clouds) {
                            localStorage.setItem('clouds', JSON.stringify(importedData.clouds));
                        }
                        
                        if (importedData.videos) {
                            localStorage.setItem('videos', JSON.stringify(importedData.videos));
                        }
                        
                        if (importedData.settings) {
                            localStorage.setItem('popupSettings', JSON.stringify(importedData.settings));
                        }
                        
                        // Refresh views
                        loadGames();
                        loadClouds();
                        loadDevData();
                        
                        alert('Dữ liệu đã được import thành công');
                    } catch (error) {
                        alert('Lỗi khi import dữ liệu: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
                elements.importDataInput.value = '';
            } catch (error) {
                console.error('Lỗi import data:', error);
                alert('Lỗi import data: ' + error.message);
            }
        }

        // Utility functions
        function showPopup(popup) {
            popup.classList.add('active');
        }

        function hidePopup(popup) {
            popup.classList.remove('active');
        }
    </script>
</body>
</html>